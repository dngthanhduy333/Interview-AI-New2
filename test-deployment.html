<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Test - InterviewPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-8">Deployment Test</h1>
            
            <!-- Environment Check -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6">Environment Check</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-3">Current Environment:</h3>
                        <div id="envInfo" class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Hostname:</span>
                                <span id="hostname" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Protocol:</span>
                                <span id="protocol" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Port:</span>
                                <span id="port" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Environment:</span>
                                <span id="environment" class="font-mono"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-3">API Configuration:</h3>
                        <div id="apiInfo" class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>API Endpoint:</span>
                                <span id="apiEndpoint" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Config Loaded:</span>
                                <span id="configLoaded" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>AZURE_CONFIG:</span>
                                <span id="azureConfig" class="font-mono"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API Test -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6">API Test</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Test Prompt:</label>
                        <textarea id="testPrompt" class="w-full p-3 border rounded-lg" rows="3" placeholder="Enter test prompt here...">Hello, this is a test message from InterviewPro deployment test.</textarea>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="testLocalAPI()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            Test Local API
                        </button>
                        <button onclick="testVercelAPI()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            Test Vercel API
                        </button>
                        <button onclick="testDirectAzure()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                            Test Direct Azure
                        </button>
                    </div>
                    
                    <div id="apiResult" class="mt-4 p-4 bg-gray-100 rounded-lg hidden">
                        <h4 class="font-semibold mb-2">API Result:</h4>
                        <pre id="apiResultText" class="text-sm overflow-x-auto"></pre>
                    </div>
                </div>
            </div>
            
            <!-- File Check -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6">File Check</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-3">Required Files:</h3>
                        <div id="fileCheck" class="space-y-2 text-sm">
                            <!-- File check results will be populated here -->
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-3">Build Files:</h3>
                        <div id="buildCheck" class="space-y-2 text-sm">
                            <!-- Build check results will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Deployment Instructions -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Deployment Instructions</h2>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold mb-2">1. Environment Variables (Vercel):</h3>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <code class="text-sm">
                                AZURE_OPENAI_API_KEY=your_api_key<br>
                                AZURE_OPENAI_ENDPOINT=your_endpoint<br>
                                AZURE_OPENAI_DEPLOYMENT=your_deployment<br>
                                AZURE_OPENAI_API_VERSION=2024-02-15-preview
                            </code>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-2">2. Deploy Commands:</h3>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <code class="text-sm">
                                npm install<br>
                                npm run build<br>
                                npm run deploy
                            </code>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-2">3. Test Commands:</h3>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <code class="text-sm">
                                npm run test:lint<br>
                                npm run test:build<br>
                                npm run build:check
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Feather icons
        feather.replace();
        
        // Environment check
        function checkEnvironment() {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            const port = window.location.port;
            const environment = hostname === 'localhost' || hostname === '127.0.0.1' ? 'Local' : 'Production';
            
            document.getElementById('hostname').textContent = hostname;
            document.getElementById('protocol').textContent = protocol;
            document.getElementById('port').textContent = port || '80/443';
            document.getElementById('environment').textContent = environment;
            
            // API configuration
            const apiEndpoint = environment === 'Local' ? '/api/openai' : '/api/openai';
            document.getElementById('apiEndpoint').textContent = apiEndpoint;
            document.getElementById('configLoaded').textContent = typeof AZURE_CONFIG !== 'undefined' ? 'Yes' : 'No';
            document.getElementById('azureConfig').textContent = typeof AZURE_CONFIG !== 'undefined' ? 'Available' : 'Not Found';
        }
        
        // File check
        async function checkFiles() {
            const requiredFiles = [
                'index.html',
                'script.js',
                'styles.css',
                'config.js',
                'package.json',
                'vercel.json',
                'api/openai.js'
            ];
            
            const buildFiles = [
                'build.js',
                'server-simple.js',
                'ocr-utils.js'
            ];
            
            const fileCheckDiv = document.getElementById('fileCheck');
            const buildCheckDiv = document.getElementById('buildCheck');
            
            // Check required files
            for (const file of requiredFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const status = response.ok ? '✅' : '❌';
                    const color = response.ok ? 'text-green-600' : 'text-red-600';
                    
                    const div = document.createElement('div');
                    div.className = `flex justify-between ${color}`;
                    div.innerHTML = `<span>${file}:</span><span>${status}</span>`;
                    fileCheckDiv.appendChild(div);
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between text-red-600';
                    div.innerHTML = `<span>${file}:</span><span>❌</span>`;
                    fileCheckDiv.appendChild(div);
                }
            }
            
            // Check build files
            for (const file of buildFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const status = response.ok ? '✅' : '❌';
                    const color = response.ok ? 'text-green-600' : 'text-red-600';
                    
                    const div = document.createElement('div');
                    div.className = `flex justify-between ${color}`;
                    div.innerHTML = `<span>${file}:</span><span>${status}</span>`;
                    buildCheckDiv.appendChild(div);
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between text-red-600';
                    div.innerHTML = `<span>${file}:</span><span>❌</span>`;
                    buildCheckDiv.appendChild(div);
                }
            }
        }
        
        // API test functions
        async function testLocalAPI() {
            await testAPI('/api/openai', 'Local API');
        }
        
        async function testVercelAPI() {
            await testAPI('/api/openai', 'Vercel API');
        }
        
        async function testDirectAzure() {
            await testAPI('direct', 'Direct Azure');
        }
        
        async function testAPI(endpoint, name) {
            const prompt = document.getElementById('testPrompt').value;
            const resultDiv = document.getElementById('apiResult');
            const resultText = document.getElementById('apiResultText');
            
            resultDiv.classList.remove('hidden');
            resultText.textContent = `Testing ${name}...`;
            
            try {
                let response;
                
                if (endpoint === 'direct') {
                    // Test direct Azure call (if config is available)
                    if (typeof AZURE_CONFIG === 'undefined') {
                        throw new Error('AZURE_CONFIG not available for direct test');
                    }
                    
                    // This would be the direct Azure call logic
                    response = { success: false, error: 'Direct Azure test not implemented in this demo' };
                } else {
                    // Test API endpoint
                    response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ prompt })
                    });
                    
                    const data = await response.json();
                    response = { success: response.ok, data, status: response.status };
                }
                
                resultText.textContent = JSON.stringify(response, null, 2);
                
            } catch (error) {
                resultText.textContent = `Error testing ${name}: ${error.message}`;
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            checkEnvironment();
            checkFiles();
        });
    </script>
</body>
</html> 